<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mikro Harita + Hava</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --bg1:#0b1220;
  --bg2:#0f2a4a;
  --card: rgba(255,255,255,.10);
  --card2: rgba(255,255,255,.06);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.68);
  --line: rgba(255,255,255,.16);
  --shadow: 0 18px 45px rgba(0,0,0,.35);
  --radius: 18px;
  --accent: #7c3aed;
  --ok:#22c55e;
  --err:#ff4d4f;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:var(--text);
  background:
    radial-gradient(900px 500px at 15% 10%, rgba(124,58,237,.35), transparent 60%),
    radial-gradient(800px 500px at 85% 20%, rgba(34,197,94,.25), transparent 60%),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  padding:28px 16px;
}

.container{
  max-width:1200px;
  margin:auto;
  display:grid;
  gap:18px;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  flex-wrap:wrap;
  gap:16px;
}

h1{margin:0;font-size:32px}
small{color:var(--muted)}

.grid{
  display:grid;
  grid-template-columns: 1.3fr .7fr;
  gap:18px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.card{
  background:linear-gradient(180deg,var(--card),var(--card2));
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow);
}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

input,button{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--line);
  font-size:15px;
}

input{
  background:rgba(255,255,255,.08);
  color:var(--text);
  min-width:240px;
}

button{
  background:linear-gradient(180deg,#7c3aed,#6d28d9);
  color:white;
  font-weight:700;
  cursor:pointer;
  border:none;
}

.status{
  margin:12px 0;
  font-size:14px;
}

#map{
  height:520px;
  border-radius:14px;
  overflow:hidden;
}

pre{
  background:rgba(10,18,32,.6);
  padding:14px;
  border-radius:14px;
  max-height:300px;
  overflow:auto;
}

.badge{
  display:inline-block;
  padding:6px 12px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid var(--line);
  font-size:13px;
}
</style>
</head>

<body>
<div class="container">

<header>
  <div>
    <h1>ğŸ—º Mikro Harita + Hava</h1>
    <small>2 Stateless API Â· Places â†’ Weather Â· Microservice</small>
  </div>
  <span class="badge">FastAPI Â· Docker Â· Leaflet</span>
</header>

<div class="grid">

<section class="card">
  <div class="controls">
    <input id="q" placeholder="Åehir ara (Istanbul, Ankaraâ€¦)">
    <button onclick="searchPlace()">Ara</button>
  </div>

  <div class="status" id="status">
    Haritaya tÄ±kla veya ÅŸehir ara
  </div>

  <div id="map"></div>
</section>

<section class="card">
  <h3>ğŸ“ SeÃ§ilen Nokta</h3>
  <div id="picked"><small>HenÃ¼z seÃ§im yok</small></div>

  <h3>ğŸŒ¦ GÃ¼ncel Hava</h3>
  <pre id="out">{}</pre>

  <small>
    APIâ€™ler: <code>/api/places</code> Â· <code>/api/weather</code>
  </small>
</section>

</div>
</div>

<script>
const map = L.map("map").setView([39,35],6);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:"Â© OpenStreetMap"
}).addTo(map);

let marker;

function setMarker(lat,lon,label){
  if(marker) marker.remove();
  marker=L.marker([lat,lon]).addTo(map);
  marker.bindPopup(label).openPopup();
}

async function searchPlace(){
  const q=document.getElementById("q").value;
  status.innerText="Konum aranÄ±yor...";
  const r=await fetch(`/api/places/search?name=${encodeURIComponent(q)}`);
  const d=await r.json();
  if(!d.results?.length){status.innerText="SonuÃ§ bulunamadÄ±";return;}
  const p=d.results[0];
  map.setView([p.latitude,p.longitude],10);
  setMarker(p.latitude,p.longitude,p.name);
  loadWeather(p.latitude,p.longitude,p.name);
}

async function loadWeather(lat,lon,name){
  status.innerText="Hava durumu alÄ±nÄ±yor...";
  const r=await fetch(`/api/weather/current?lat=${lat}&lon=${lon}`);
  const d=await r.json();
  picked.innerHTML=`<small><b>${name}</b><br>Lat:${lat}, Lon:${lon}</small>`;
  out.textContent=JSON.stringify(d,null,2);
  status.innerText="GÃ¼ncel veri alÄ±ndÄ±";
}

map.on("click",e=>{
  setMarker(e.latlng.lat,e.latlng.lng,"SeÃ§ilen Nokta");
  loadWeather(e.latlng.lat,e.latlng.lng,"Harita");
});
</script>
</body>
</html>
